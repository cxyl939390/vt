
<style>
    .cart {  display: none;
    }
    .cart-empty{
        height: 98px;
        border: 1px solid #ddd;

    }
    .cart-empty .message {
        height: 98px;
        padding-left: 341px;

    }
    .cart-empty .message p {
        line-height: 98px;
    }
    .cart-inner {
        border: 1px solid #ddd;
        border-top: 2px solid #999;
    }
    .item_selected {
        background-color: #fffdee!important;
    }

    .cart-total {
        background-color: #f7f7f7;
        border-top: 1px solid #ddd;
        height: 48px;
        line-height: 48px;
    }.cart-total .cart-button {
         float: right;
         padding: 0;
     }.cart-total .total {
          margin-right: 20px;
      }
    .fr {
        float: right;
    }
input[type="number"]{
        width: 30%; float: left; margin-left: 5%;
         }

    .subtract{
        font-size: 26px;
        line-height: 37px;

        border: 1px solid#cccccc;
        font-family: monospace;
    }
        .addition{
            font-size: 26px ;margin-left: 3%;line-height: 36px;border: 1px solid#cccccc
        }
</style>




<div class="row" >


  <div id="cart">
    <h2>我的购物车</h2>
    <div class="cart-inner  <%unless @line_items.count>0%> hide<%end%>">
      <table style="width: 100%">
        <thead>
        <tr>
          <td>商品</td>
          <td>价格</td>
          <td>数量</td>
          <td>操作</td>
        </thead>
        <tbody>
        <%@line_items.select{ |x| x.good.present? && x.product.present? }.each do |line_item|%>


            <tr id="line_<%=line_item.obj_ident%>" class="item_selected">


              <td width="25%" >
                <a class="p-img" href="/products/<%=line_item.good.bn%>" target="_blank" >

                  <img src="<%=line_item.good.medium_pic%>"
                       data-original="<%=line_item.good.medium_pic%>"
                       data-onerror="<%=line_item.good.medium_pic%>"
                       data-brandlazy="true" >
                </a>
                <%=line_item.product.name%>
              </td>
              <td width="30%">  <% if cookies[:MLV] == "10" %>
                    <span class="good_price"><%= format('%.2f',line_item.product.bulk)%></span>
                <%else%>
                    <span class="good_price">￥<%= format('%.2f',line_item.product.price)%></span>
                <%end%></td>

              <td width="15%">
                </span>
               <span class="good_data_num_l J_num_cart_reduce left" >
                <a href="javascript:;" class="subtract"  >-</a>
         </span>

                <em class="good_data_num_m J_num_cart_txt">
                  <%=number_field_tag :quantity,line_item.quantity.to_i,:class=>"textcenter quantity good_data_num_m J_num_cart_txt",:size=>3,:min=>1,:'data-url'=>cart_path(line_item.obj_ident)%>
                </em>
         <span class="good_data_num_r J_num_cart_add " style="margin-left: 4px"  >
                      <a href="javascript:;" class="addition" mars_sead="cart_edit_btn"   >+</a>
        </span>
              </td>
              <td width="30%">


                <%=link_to "删除",cart_path(line_item.obj_ident),:class=>"delete",:remote=>true,:method=>:delete%>
                <br>

              </td>

            </tr>

        <%end%>
        </tbody>

      </table>
      <div class="cart-total ">
        <div class="cart-button">
                  <span >
                      <a class="button small" href="<%=site%>/orders/new"  id="">去结算</a>
                  </span>


        </div>
        <div class="total fr">
          总计（不含运费）：
          <span class="total" >￥<%= format('%.2f',@cart_total)%></span>
        </div>
      </div>
          </div>

          <div class="cart-empty <%if @line_items.count>0%> hide<%end%>">
          <div class="message">
            <p><i class="fi-shopping-cart " style="font-size: 50px"></i>购物车内暂时没有商品，您可以<a href="/">去首页</a>挑选喜欢的商品<!-- ，或<a href="###" class="btn-takeout">取出之前寄存的商品</a> --></p>
          </div>


    </div>
  </div></div>





<script>

    $(document).ready(function(){

        $(" .quantity").on("change",function(){
            var quantity = $(this).val();
            if(!/\d+/.test(quantity)) return false;
            var url = $(this).data('url');
            $.ajax(url,{
                type: "PUT",
                data:{ quantity:quantity },
                success:function(res){
                }
            });
        });

        $(".subtract").click(function(){
            var quone= $(this).parents().parents().children(".good_data_num_m").children("#quantity");
            var quantitys = quone.val();

            if (quantitys<=1){
                alert("亲，不能在减了～") ;return false;
            }
            else{
                var quantity= quantitys-1;
                quone.val(quantity) ;
                var url = quone.data('url');
                $.ajax(url,{
                    type: "PUT",
                    data:{ quantity:quantity },
                    success:function(res){
                    }
                });
            }
        });
        $(".addition").click(function(){
            var qutwo=  $(this).parents().parents().children(".good_data_num_m").children("#quantity");
            var quantitys = qutwo.val();
            var quantity = quantitys * 1 + 1;
            qutwo.val(quantity);

            var url =qutwo.data('url');

            $.ajax(url, {
                type: "PUT",
                data: { quantity: quantity },
                success: function (res) {
                }
            });

        });
    });
</script>