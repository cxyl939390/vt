<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, target-densityDpi=device-dpi" />-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <title><%= I18n.t 'title' %></title>
  <meta content="" name="keywords">
  <meta content="" name="description">
<%= stylesheet_link_tag    "amaze/amazeui.min.css" %>
<%= stylesheet_link_tag    "amaze/amazeui.widgets.min.css" %>
<link rel="stylesheet" type="text/css" href="/assets/timeplug/jquery.datetimepicker.css"/>

<style>.bottomdivsclearfix{display: none} .evenfont{color: #0e90d2;}</style>
<div class="am-g"style="padding: 15px">
  <!--完善个人信息-->
  <div  id="step1"  style="display: none;">
  <div style="border: none" data-am-widget="titlebar" class="am-titlebar am-titlebar-default am-no-layout">
    <h2 class="am-titlebar-title">完善个人信息</h2>
  </div>
  <%=form_for :user,:url=>"/events/party/stepone" ,:html => {:class => "am-form"} do |f| %>

        <div class="am-input-group">
          <span class="am-input-group-label"><i class="am-icon-user"></i></span>
          <%=f.text_field :name,:class=>"input" ,:placeholder=>"请输入您的姓名"%>
        </div>
          <br>
        <div class="am-input-group">
          <span class="am-input-group-label"><i class="am-icon-envelope"></i></span>
          <%=f.text_field :email,:class=>"input" ,:placeholder=>"请输入您的邮箱"%>
        </div>
   <br>
        <div class="am-input-group">
          <span class="am-input-group-label"><i class="am-icon-weixin"></i></span>
          <%=f.text_field :wechat_num,:class=>"input" ,:placeholder=>"请输入您的微信号"%>
        </div>
        <br>
      <%=f.submit "下一步", :class=>"am-btn am-btn-block am-btn-warning"%>
  <%end%>    </div>

    <!--发布活动-->


<div  id="step2"  style="display: none;">
  <div style="border: none" data-am-widget="titlebar" class="am-titlebar am-titlebar-default am-no-layout">
    <h2 class="am-titlebar-title">发布活动</h2>
  </div>

  <%=form_for :event,:url=>"/events/party/steptwo" ,:html => {:class => "eventform am-form"} do |f| %>
       <%=f.hidden_field :terminal ,:value=>"mobile"%>
      <%=f.hidden_field :member_id ,:value=>@user.member_id%>

      <div class="am-input-group">
        <span class="am-input-group-label"><i class="am-icon-cutlery"></i></span>
        <%= f.text_field :name, :placeholder => "活动名称" %>
      </div>
      <br>
     <div class="am-input-group">
        <span class="am-input-group-label"><i class="am-icon-map-marker"></i></span>
        <%=f.text_field :adds,:class=>"input" ,:placeholder=>"请输入活动地址"%>
      </div>
      <br>
      <div class="am-input-group">
        <span class="am-input-group-label"><i class="am-icon-clock-o"></i></span>
        <%=f.text_field :endtime,:class=>"input" ,:id=>"endatetimepicker",:placeholder=>"请选择报名截止时间"%>
      </div> <br>

      <div class="am-input-group">
        <span class="am-input-group-label"><i class="am-icon-clock-o"></i></span>
        <%=f.text_field :startime,:class=>"input" ,:id=>"startdatetimepicker",:placeholder=>"请选择活动开始时间"%>
      </div> <br>

      <div class="am-input-group">

        <%=f.text_area :body,:class=>"input" ,:placeholder=>"请输入活动内容" ,:style=>"height:60px"%>
      </div> <br>

      <input class=" am-btn am-btn-block am-btn-warning submit" name="commit" type="button" value="确  认">

      <%end%>        </div>


  <div  id="step3"  style="display: none;">

    <br><br>
    <div class="am-list-news-bd">

      <ul class="am-list">
        <li style="border: none" class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left" >
          <div class="am-col col-sm-2 am-list-thumb" style="line-height: 4">
            <img src="/assets/tick.png" >
          </div>
          <div class="am-col col-sm-10 am-list-main">
            <div style="text-align: center;color: #ff0000">温馨提示</div>
            <div class="dotted">   </div>
            <span class="evenfont" ><%=@user.name%>您好:&nbsp;&nbsp;&nbsp;恭喜您发布成功!!!</span> <br>



          </div>  </li> </ul>
    </div>
    <p  class=""style="font-size: 14px"> 您可以在<a href="/vshop/78/user?id=78">个人中心</a>查看我的活动信息或者是在<a href="/events/foodie?supplier_id=78">吃货平台</a>里查看</p>
    <a href="/events/foodie?supplier_id=78" >点击返回吃货平台</a>
  </div>
</div>




<SCRIPT type="text/javascript">

    if ('<%=params[:step]%>'=='2'){
        document.getElementById("step2").style.display="";
    }
    else if('<%=params[:step]%>'=='3'){
        document.getElementById("step3").style.display="";
    }
    else{
        document.getElementById("step1").style.display="";
    }

</SCRIPT>

<script src="/assets/jquery.min.js"></script>

<script src="/assets/timeplug/jquery.datetimepicker.js"></script>


  <script> $('#startdatetimepicker').datetimepicker({
      format:'Y-m-d H:i',
      lang:'ch'

  });
          $('#endatetimepicker')  .datetimepicker({
              format:'Y-m-d H:i',
              lang:'ch'

          });

  </script>
<script>
  $(document).ready(function(){


    $(".submit").click(function(){
        var startime=$("#startdatetimepicker").val();
        var endtime=$("#endatetimepicker").val();

        if( new Date(endtime)> new Date(startime)){
           alert("报名截至时间不能大于活动开始时间"); return false;
        }

       var event_name=$("#event_name").val();
        var event_adds=$("#event_adds").val();
        var event_times=$("#event_times").val();
        if (event_name==""||event_adds==""||event_times=="") {
          alert("信息量不足!无法发布活动哦!");
            return false;
        }
        else{
            $(".eventform").submit();
        }
    })
  })


</script>

<div class="footer clearfix">
<% return_url={:return_url => request.url.sub('http://trade','').force_encoding('UTF-8')}.to_query%>
<%if @user%>
    <script>
        if ('<%=@user.account.supplier_id %>'!='<%=@supplier.id%>'){
            location.href = "/auto_login?id=<%=@supplier.id%>&<%=return_url%>&platform=mobile"
        }
    </script>
<%else%>
    <script>
        location.href = "/auto_login?id=<%=@supplier.id%>&<%=return_url%>&platform=mobile"
    </script>
<%end%>
<p class="copyright" style="display: none">Copyright © 2013-2014 trade-v.com <br/>版权所有 上海普慧信息科技有限公司 All rights reserved. <br/>沪ICP备13045311号-1 </p>
<p style="display:none">from=<%=session[:wechat_user]%>|recommend=<%=session[:recommend_user]%></p>
</div>


<script type="text/javascript">



    function wechatShare(data) {
        // If no data is defined, just fallback to wechat's default behaviour.
        if (!data) {
            return;
        }
        var title = data.title || document.title;
        var desc = data.desc || "分享";
        var url = data.url || document.location.href;

        function getDefaultImage() {
            var images = document.getElementsByTagName("img");
            if (images && images.length > 0) {
                for (var i = 0; i < images.length; i++) {
                    var image = images[i];
                    if (image.width > 140 && image.height > 130 && $(image).is(":visible")) {
                        return image.src;
                    }
                }
            }
            return null;
        }
        function shareFriend() {
            // Delay image loading to the time when DOM is ready.
            var img = data.img || getDefaultImage();
            WeixinJSBridge.invoke("sendAppMessage", {
                "img_url": img,
                "link": url,
                "desc": desc,
                "title": title
            }, function(res) {
            });
        }
        function shareTimeline() {
            var img = data.img || getDefaultImage();
            WeixinJSBridge.invoke("shareTimeline", {
                "img_url": img,
                "link": url,
                "desc": desc,
                "title": title
            }, function(res) {
            });
        }
        function shareWeibo() {
            var img = data.img || getDefaultImage();
            WeixinJSBridge.invoke("shareWeibo", {
                "img_url": img,
                "content": title,
                "url": url,
                "desc": desc,
                "title": title
            }, function(res) {
            });
        }

        document.addEventListener("WeixinJSBridgeReady", function onBridgeReady() {

            WeixinJSBridge.on("menu:share:appmessage", function(argv) {
                shareFriend();
                <%if @user==nil%>
                alert('您还没有登录，只有登录后，分享给朋友，才可能赚到佣金噢！');
                <%end%>
            });
            WeixinJSBridge.on("menu:share:timeline", function(argv) {
                shareTimeline();
                <%if @user==nil%>
                alert('您还没有登录，只有登录后，分享给朋友，才可能赚到佣金噢！');
                <%end%>
            });
            WeixinJSBridge.on("menu:share:weibo", function(argv) {
                shareWeibo();
                <%if @user==nil%>
                alert('您还没有登录，只有登录后，分享给朋友，才可能赚到佣金噢！');
                <%end%>
            });
        }, false);
    }
    <%if @user%>
    <%useraccount=@user.account.login_name%>
    <%end%>
    var current_url = document.location.href;
    //去除上一个推荐者的链接
    var imgs=null
    var descs=null


    if (document.location.href.indexOf('order')>0){
        var pathname = document.location.pathname;
        if (pathname=="/orders/mobile_show_order"||pathname=="/orders/mobile_show"){
            pathnames="/orders/share_order";
            var serach =document.location.search;
            var host=document.location.host;

            var url=host + pathnames+serach;
            current_url=url

        }

    }
    if (document.location.search=="?name=%E9%A6%99%E8%82%A0&id=78"){

        imgs="http://vshop.trade-v.com/images/a077/xiangchang.png"

        descs="德国老祖母级香肠，原汁原味，来自德国的美味！";
    }

    if (document.location.pathname=="/pages/about_zmq"){

        descs="卓玛泉西藏冰川水 喝水也可以如此美好";
        imgs="http://vshop.trade-v.com/images/a104/zhuoma.png"

    }

    num_index_of = current_url.indexOf("&from=weixin&wechatuser=");
    if (num_index_of >0){
        current_url = current_url.substr(0,num_index_of);
    }
    current_url += "&from=weixin&wechatuser=<%=useraccount%>";
    // alert(current_url);

    var data = {"img":imgs,"url":current_url,"title":"关注贸威，转发朋友，享受更优质生活！<%#=@wechat_share_title%>","desc":descs};
    wechatShare(data);
</script>


<script type="text/javascript">
    var _smq = _smq || [];
    _smq.push(['_setAccount', '63e2363', new Date()]);
    _smq.push(['_setDirectoryIndex', '/m/']);
    _smq.push(['_setHeatmapEnabled', 'no']);
    _smq.push(['pageview']);
</script>
<script type="text/javascript">
    $(function(){
        var $clickBox = $('#channel_img')
        $clickBox.off('click.push.count','a.itemList').on('click.push.count','a.itemList', function(){
            var t = $(this),
                    dom = {
                        index: $clickBox.find('a.itemList').index(t) + 1,
                    };
            (dom.index > 0 && dom.index < 31) && _smq.push(['pageview','/brandlist', dom.index.toString()]);
        })
    })
</script>









<script>
    $(document).ready(function(){


        $("#showall").click(function() {
            pathname = document.location.pathname;
            url = document.location.href;
            serach = document.location.search;
            host = document.location.host;

            var langeval = $("#lange").html();



            function parseURL(url) {
                var a = document.createElement('a');
                a.href = url;
                return {
                    source: url,
                    protocol: a.protocol.replace(':', ''),
                    host: a.hostname,
                    port: a.port,
                    query: a.search,
                    params: (function () {
                        var ret = {},
                                seg = a.search.replace(/^\?/, '').split('&'),
                                len = seg.length, i = 0, s;
                        for (; i < len; i++) {
                            if (!seg[i]) { continue; }
                            s = seg[i].split('=');
                            ret[s[0]] = s[1];
                        }
                        return ret;

                    })(),
                    file: (a.pathname.match(/\/([^\/?#]+)$/i) || [, ''])[1],
                    hash: a.hash.replace('#', ''),
                    path: a.pathname.replace(/^([^\/])/, '/$1'),
                    relative: (a.href.match(/tps?:\/\/[^\/]+(.+)/) || [, ''])[1],
                    segments: a.pathname.replace(/^\//, '').split('/')
                };
            }

//替换myUrl中的同名参数值
            function replaceUrlParams(myUrl, newParams) {
                for (var x in newParams) {
                    var hasInMyUrlParams = false;
                    for (var y in myUrl.params) {
                        if (x.toLowerCase() == y.toLowerCase()) {
                            myUrl.params[y] = newParams[x];
                            hasInMyUrlParams = true;
                            break;
                        }
                    }
                    //原来没有的参数则追加
                    if (!hasInMyUrlParams) {
                        myUrl.params[x] = newParams[x];
                    }
                }
                var _result = myUrl.protocol + "://" + myUrl.host + ":" + myUrl.port + myUrl.path + "?";

                for (var p in myUrl.params) {
                    _result += (p + "=" + myUrl.params[p] + "&");
                }

                if (_result.substr(_result.length - 1) == "&") {
                    _result = _result.substr(0, _result.length - 1);
                }

                if (myUrl.hash != "") {
                    _result += "#" + myUrl.hash;
                }
                return _result;
            }

//辅助输出

            urlsss=document.location.href
            var myURL = parseURL(urlsss);

            if (langeval == "|English") {
                var _newUrl = replaceUrlParams(myURL, {locale: "en"}); }
            else{
                var _newUrl = replaceUrlParams(myURL, {locale: "zh_cn"});
            }
            window.location.href=_newUrl;




        })

    })


</script>
</body></html>

